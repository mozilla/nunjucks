<!DOCTYPE html>
<html>
  <head>
    <title>Nunjucks</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css"
          href="/nunjucks/bower_components/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="/nunjucks/css/highlight.css" />
    <link rel="stylesheet" type="text/css" href="/nunjucks/css/app.css" />
    <link rel="icon" type="image/png" href="/nunjucks/img/favicon.png" />
  </head>

  <body id="">
    <nav class="navbar navbar-default ">
      <a class="pull-left logo" href="/nunjucks/">Nunjucks</a>

      <ul class="nav navbar-nav navbar-right pull-right">
        <li><a href="/nunjucks/#download" class="download">Download</a></li>
        <li><a href="https://github.com/mozilla/nunjucks">GitHub</a></li>
        <li class="dropdown">
          <a href="getting-started.html" data-toggle="dropdown">Docs</a>

          <ul class="dropdown-menu">
            <li><a href="getting-started.html">Getting Started</a></li>
            <li><a href="templating.html">Templating</a></li>
            <li><a href="api.html">API</a></li>
            <li><a href="faq.html">FAQ</a></li>
          </ul>
        </li>
      </ul>
    </nav>

<div class="content clearfix">
  <aside class="col-sm-3">
    <div class="pages">
      <p><strong>Documentation</strong></p>

      <ul>
        <li><a href="getting-started.html">Getting Started</a></li>
        <li><a href="templating.html">Templating</a></li>
        <li><a href="api.html">API</a></li>
        <li><a href="faq.html">FAQ</a></li>
      </ul>
    </div>

    <div class="toc">
      <p><strong>Templates</strong></p>
      <ul>
<li>
<a href="#part-6542c9dca76">模板</a>
<ul>
<li>
<a href="#part-d0678dc0cc4cc122">文件扩展名</a>
</li>
<li>
<a href="#part-654287f5790">变量</a>
</li>
<li>
<a href="#part-37871b6860f08be">过滤器</a>
</li>
<li>
<a href="#part-2cf2ea1f8614528d">模板继承</a>
<ul>
<li>
<a href="#super">super</a>
</li>
</ul>
</li>
<li>
<a href="#part-6542bfecae4">标签</a>
<ul>
<li>
<a href="#if">if</a>
</li>
<li>
<a href="#for">for</a>
</li>
<li>
<a href="#asynceach">asyncEach</a>
</li>
<li>
<a href="#asyncall">asyncAll</a>
</li>
<li>
<a href="#macro">macro</a>
</li>
<li>
<a href="#set">set</a>
</li>
<li>
<a href="#extends">extends</a>
</li>
<li>
<a href="#block">block</a>
</li>
<li>
<a href="#include">include</a>
</li>
<li>
<a href="#import">import</a>
</li>
<li>
<a href="#raw">raw</a>
</li>
<li>
<a href="#filter">filter</a>
</li>
<li>
<a href="#call">call</a>
</li>
</ul>
</li>
<li>
<a href="#part-9d9c663eba1f6097">关键字参数</a>
</li>
<li>
<a href="#part-6542d68b860">注释</a>
</li>
<li>
<a href="#part-861ece9d8e5ce60c">空白字符控制</a>
</li>
<li>
<a href="#part-3787096c788cc4a">表达式</a>
<ul>
<li>
<a href="#math">运算 (Math)</a>
</li>
<li>
<a href="#comparisons">比较 (Comparisons)</a>
</li>
<li>
<a href="#logic">Logic</a>
</li>
<li>
<a href="#if">If 表达式</a>
</li>
<li>
<a href="#function-calls">函数调用 (Function Calls)</a>
</li>
<li>
<a href="#part-f8640494c1eb9d66">正则表达式</a>
</li>
</ul>
</li>
<li>
<a href="#autoescaping">自动转义 (Autoescaping)</a>
</li>
<li>
<a href="#global-functions">全局函数 (Global Functions)</a>
<ul>
<li>
<a href="#range-start-stop-step">range([start], stop, [step])</a>
</li>
<li>
<a href="#cycler-item1-item2-itemn">cycler(item1, item2, ...itemN)</a>
</li>
<li>
<a href="#joiner-separator">joiner([separator])</a>
</li>
</ul>
</li>
<li>
<a href="#part-cda1d805a3577fa5">内置的过滤器</a>
<ul>
<li>
<a href="#default-value-default-boolean">default(value, default, [boolean])</a>
</li>
<li>
<a href="#sort-arr-reverse-casesens-attr">sort(arr, reverse, caseSens, attr)</a>
</li>
<li>
<a href="#striptags-value-preserve_linebreaks">striptags (value, [preserve_linebreaks])</a>
</li>
<li>
<a href="#dump-object">dump (object)</a>
</li>
<li>
<a href="#part-e05b7664d3942ab3">其他过滤器</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
  </aside>

  <div class="col-sm-9 main">
    <div class="locale btn-group"><a href="/nunjucks/templating.html" class="btn btn-default">English</a><a href="/nunjucks/cn/templating.html" class="btn btn-success">中文</a><a href="/nunjucks/fr/templating.html" class="btn btn-default">Français</a></div>
    <h1 id="part-6542c9dca76">模板</h1>

<p>这里包括 Nunjuck 所有可用的功能。</p>

<blockquote>
<p>Nunjucks 是
<a href="http://jinja.pocoo.org/docs/">jinja2</a> 的 javascript 的实现，所以如果此文档有什么缺失，你可以直接查看 <a href="http://jinja.pocoo.org/docs/templates/">jinja2 的文档</a>，不过两者之间还存在一些<a href="http://mozilla.github.io/nunjucks/cn/faq.html">差异</a>。</p>
</blockquote>

<h2 id="part-d0678dc0cc4cc122">文件扩展名</h2>

<p>虽然你可以用任意扩展名来命名你的Nunjucks模版或文件，但Nunjucks社区还是推荐使用<code>.njk</code>。</p>

<p>如果你在给Nunjucks开发工具或是编辑器上的语法插件时，请记得使用<code>.njk</code>扩展名。</p>

<h2 id="part-654287f5790">变量</h2>

<p>变量会从模板上下文获取，如果你想显示一个变量可以：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">username</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>会从上下文查找 <code>username</code> 然后显示，可以像 javascript 一样获取变量的属性 (可使用点操作符或者中括号操作符)：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo.bar</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">foo</span><span class="o">[</span><span class="s2">&quot;bar&quot;</span><span class="o">]</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>如果变量的值为 <code>undefined</code> 或 <code>null</code> 将不显示，引用到 undefined 或 null 对象也是如此 (如 <code>foo</code> 为 undefined，<code>{{ foo }}</code>, <code>{{
foo.bar }}</code>, <code>{{ foo.bar.baz }}</code> 也不显示)。</p>

<h2 id="part-37871b6860f08be">过滤器</h2>

<p>过滤器是一些可以执行变量的函数，通过管道操作符 (<code>|</code>) 调用，并可接受参数。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span> <span class="o">|</span> <span class="nf">title</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">foo</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s2">&quot;,&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">foo</span> <span class="o">|</span> <span class="nf">replace</span><span class="o">(</span><span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="s2">&quot;bar&quot;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">capitalize</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>第三个例子展示了链式过滤器，最终会显示 &quot;Bar&quot;，第一个过滤器将 &quot;foo&quot; 替换成 &quot;bar&quot;，第二个过滤器将首字母大写。</p>

<p>Nunjucks 提供了一些<a href="#%E5%86%85%E7%BD%AE%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8">内置的过滤器</a>，你也可以<a href="api#custom-filters">自定义过滤器</a>。</p>

<h2 id="part-2cf2ea1f8614528d">模板继承</h2>

<p>模板继承可以达到模板复用的效果，当写一个模板的时候可以定义 &quot;blocks&quot;，子模板可以覆盖他，同时支持多层继承。</p>

<p>如果有一个叫做 <code>parent.html</code> 的模板，如下所示：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">header</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">This is the default content</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">&lt;section class=&quot;left&quot;&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">left</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;/section&gt;</span>

<span class="x">&lt;section class=&quot;right&quot;&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">right</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  This is more content</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;/section&gt;</span>
</code></pre></div>
<p>然后再写一个模板继承他</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;parent.html&quot;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">left</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">This is the left side!</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">right</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">This is the right side!</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>以下为渲染结果</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="x">This is the default content</span>

<span class="x">&lt;section class=&quot;left&quot;&gt;</span>
<span class="x">  This is the left side!</span>
<span class="x">&lt;/section&gt;</span>

<span class="x">&lt;section class=&quot;right&quot;&gt;</span>
<span class="x">  This is the right side!</span>
<span class="x">&lt;/section&gt;</span>
</code></pre></div>
<p>你可以将继承的模板设为一个变量，这样就可以动态指定继承的模板。这个变量既可以是个指向模板文件的字符串，也可以是个模板编译后所生成的对象(需要添加上下文环境)。因此你可以通过设置上下文变量，从而在渲染时动态地改变所要继承的模板。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">parentTemplate</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>继承功能使用了 <a href="#extends"><code>extends</code></a> 和 <a href="#block"><code>block</code></a> 标签，<a href="http://jinja.pocoo.org/docs/templates/#template-inheritance">jinja2 文档</a>中有更细节的描述。</p>

<h3 id="super">super</h3>

<p>你可以通过调用<code>super</code>从而将父级区块中的内容渲染到子区块中。如果在前面的例子中你的子模板是这样的：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">right</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">Right side!</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>这个区块的渲染结果将是：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">This is more content
Right side!
</code></pre></div>
<h2 id="part-6542bfecae4">标签</h2>

<p>标签是一些特殊的区块，它们可以对模板执行一些操作。Nunjucks 包含一些内置的标签，你也可以<a href="api.html#custom-tags">自定义</a>。</p>

<h3 id="if">if</h3>

<p><code>if</code> 为分支语句，与 javascript 中的 <code>if</code> 类似。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">variable</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  It is true</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>如果 <code>variable</code> 定义了并且为 true <em>(译者注：这里并非布尔值，和 javascript 的处理是一样的)</em> 则会显示 &quot;It is true&quot;，否则什么也不显示。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">hungry</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  I am hungry</span>
<span class="cp">{%</span> <span class="k">elif</span> <span class="nv">tired</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  I am tired</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  I am good!</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>在<a href="#if-%E8%A1%A8%E8%BE%BE%E5%BC%8F">内联表达式</a>(inline expression)中也可以使用 if。</p>

<h3 id="for">for</h3>

<p><code>for</code> 可以遍历数组 (arrays) 和对象 (dictionaries)。</p>

<blockquote>
<p>如果你使用的自定义模板加载器为异步的可查看 <a href="#asynceach"><code>asyncEach</code></a></p>
</blockquote>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[{</span> <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">}];</span>
</code></pre></div><div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="x">&lt;h1&gt;Posts&lt;/h1&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">items</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  &lt;li&gt;</span><span class="cp">{{</span> <span class="nv">item.title</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  &lt;li&gt;This would display if the &#39;item&#39; collection were empty&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<p>上面的示例通过使用<code>items</code>数组中的每一项的<code>title</code>属性显示了所有文章的标题。如果<code>items</code>数组是空数组的话则会渲染<code>else</code>语句中的内容。</p>

<p>你还可以遍历对象：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">food</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;ketchup&#39;</span><span class="o">:</span> <span class="s1">&#39;5 tbsp&#39;</span><span class="p">,</span>
  <span class="s1">&#39;mustard&#39;</span><span class="o">:</span> <span class="s1">&#39;1 tbsp&#39;</span><span class="p">,</span>
  <span class="s1">&#39;pickle&#39;</span><span class="o">:</span> <span class="s1">&#39;0 tbsp&#39;</span>
<span class="p">};</span>
</code></pre></div><div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">ingredient</span><span class="o">,</span> <span class="nv">amount</span> <span class="k">in</span> <span class="nv">food</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  Use </span><span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span><span class="x"> of </span><span class="cp">{{</span> <span class="nv">ingredient</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p><a href="http://jinja.pocoo.org/docs/templates/#dictsort"><code>dictsort</code></a> 过滤器可将对象排序 (<em>new in 0.1.8</em>)</p>

<p>除此之外，Nunjucks 会将数组解开，数组内的值对应到变量 (<em>new in 0.1.8</em>)</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]];</span>
</code></pre></div><div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">x</span><span class="o">,</span> <span class="nv">y</span><span class="o">,</span> <span class="nv">z</span> <span class="k">in</span> <span class="nv">points</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  Point: </span><span class="cp">{{</span> <span class="nv">x</span> <span class="cp">}}</span><span class="x">, </span><span class="cp">{{</span> <span class="nv">y</span> <span class="cp">}}</span><span class="x">, </span><span class="cp">{{</span> <span class="nv">z</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>在循环中可获取一些特殊的变量</p>

<ul>
<li><code>loop.index</code>: 当前循环数 (1 indexed)</li>
<li><code>loop.index0</code>: 当前循环数 (0 indexed)</li>
<li><code>loop.revindex</code>: 当前循环数，从后往前 (1 indexed)</li>
<li><code>loop.revindex0</code>: 当前循环数，从后往前 (0 based)</li>
<li><code>loop.first</code>: 是否第一个</li>
<li><code>loop.last</code>: 是否最后一个</li>
<li><code>loop.length</code>: 总数</li>
</ul>

<h3 id="asynceach">asyncEach</h3>

<blockquote>
<p>这个是适用于异步模板，请读<a href="api.html#asynchronous-support">文档</a>。</p>
</blockquote>

<p><code>asyncEach</code> 为 <code>for</code> 的异步版本，只有当使用<a href="#asynchronous">自定义异步模板加载器</a>的时候才使用，否则请不要使用。异步过滤器和扩展也需要他。如果你在循环中使用了异步过滤器的话，Nunjucks就会在内部自动将循环转换成 <code>asyncEach</code>。</p>

<p><code>asyncEach</code> 和 <code>for</code> 的使用方式一致，但他支持循环的异步控制。将两者区分的原因是性能，大部分人使用同步模板，将 <code>for</code> 转换成原生的 for 语句会快很多。</p>

<p>编译时 nunjuck 不用关心模板是如何加载的，所以无法决定 <code>include</code> 是同步或异步。这也是为什么Nunjucks无法自动将普通的循环语句转换成异步循环语句的原因，所以如果你要使用异步模板加载器的话，就需要使用 <code>asyncEach</code>。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// If you are using a custom loader that is async, you need asyncEach</span>
<span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nunjucks</span><span class="p">.</span><span class="nx">Environment</span><span class="p">(</span><span class="nx">AsyncLoaderFromDatabase</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="x">&lt;h1&gt;Posts&lt;/h1&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">asyncEach</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">items</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;item-template.html&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endeach</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<h3 id="asyncall">asyncAll</h3>

<blockquote>
<p>这个是适用于异步模板，请读<a href="api.html#asynchronous-support">文档</a>。</p>
</blockquote>

<p><code>asyncAll</code> 和 <code>asyncEach</code> 类似，但 <code>asyncAll</code> 会并行的执行，并且每项的顺序仍然会保留。除非使用异步的过滤器、扩展或加载器，否则不要使用。</p>

<p>如果你写了一个 <code>lookup</code> 的过滤器用来从数据库获取一些文本，使用 <code>asyncAll</code> 可以并行渲染。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="x">&lt;h1&gt;Posts&lt;/h1&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">asyncAll</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">items</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  &lt;li&gt;</span><span class="cp">{{</span> <span class="nv">item.id</span> <span class="o">|</span> <span class="nf">lookup</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endall</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<p>如果 <code>lookup</code> 是一个异步的过滤器，那么可能会比较慢（如从磁盘获取些数据）。<code>asyncAll</code> 会减少执行的时间，他会并行执行所有的异步操作，当所有的操作完成后才会继续渲染页面。</p>

<h3 id="macro">macro</h3>

<p>宏 (<code>macro</code>) 可以定义可复用的内容，类似与编程语言中的函数，看下面的示例：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">field</span><span class="o">(</span><span class="nv">name</span><span class="o">,</span> <span class="nv">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">,</span> <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;div class=&quot;field&quot;&gt;</span>
<span class="x">  &lt;input type=&quot;</span><span class="cp">{{</span> <span class="nv">type</span> <span class="cp">}}</span><span class="x">&quot; name=&quot;</span><span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">         value=&quot;</span><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">escape</span> <span class="cp">}}</span><span class="x">&quot; /&gt;</span>
<span class="x">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>现在 <code>field</code> 可以当作函数一样使用了：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">field</span><span class="o">(</span><span class="s1">&#39;user&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">field</span><span class="o">(</span><span class="s1">&#39;pass&#39;</span><span class="o">,</span> <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>支持<a href="#%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0">关键字参数</a>，通过链接查看具体使用方式。</p>

<p>还可以从其他模板 <a href="#import">import</a> 宏，可以使宏在整个项目中复用。</p>

<p><strong>重要</strong>：如果你使用异步 API，请注意你 <strong>不能</strong> 在宏中做任何异步的操作，因为宏只是像函数一样被简单地调用。将来我们可能会提供一种异步的宏调用方式，但现在这么使用是不被支持的。</p>

<h3 id="set">set</h3>

<p><code>set</code> 可以设置和修改变量。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">username</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">username</span> <span class="o">=</span> <span class="s2">&quot;joe&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">username</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>如果 <code>username</code> 初始化的时候为 &quot;james&#39;, 最终将显示 &quot;james joe&quot;。</p>

<p>可以设置新的变量，并一起赋值。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">x</span><span class="o">,</span> <span class="nv">y</span><span class="o">,</span> <span class="nv">z</span> <span class="o">=</span> <span class="m">5</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>如果在顶级作用域使用 <code>set</code>，将会改变全局的上下文中的值。如果只在某个作用域 (像是include或是macro) 中使用，则只会影响该作用域。</p>

<p>同样地，你也可以使用区块赋值将一个区块的内容储存在一个变量中。</p>

<p>它的语法和标准的<code>set</code>语法相似，只不过你不需要用<code>=</code>。区块中从头到<code>{% endset %}</code>之间的内容都会被捕获，并作为值来使用。</p>

<p>在某些情境下，你可以用这种语法来替代宏：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">standardModal</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;standardModalData.html&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endset</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">&lt;div class=&quot;js-modal&quot; data-modal=&quot;</span><span class="cp">{{</span><span class="nv">standardModal</span> <span class="o">|</span> <span class="nf">e</span><span class="cp">}}</span><span class="x">&quot;&gt;</span>
</code></pre></div>
<h3 id="extends">extends</h3>

<p><code>extends</code> 用来指定模板继承，被指定的模板为父级模板，查看<a href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF">模板继承</a>。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>你可以将继承的模板设为一个变量，这样就可以动态指定继承的模板。这个变量既可以是个指向模板文件的字符串，也可以是个模板编译后所生成的对象(需要添加上下文环境)。因此你可以通过设置上下文变量，从而在渲染时动态地改变所要继承的模板。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">parentTemplate</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p><code>extends</code>也可以接受任意表达式，只要它最终返回一个字符串或是模板所编译成的对象：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">extends</span> <span class="nv">name</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span> <span class="cp">%}</span><span class="x">`.</span>
</code></pre></div>
<h3 id="block">block</h3>

<p>区块(<code>block</code>) 定义了模板片段并标识一个名字，在模板继承中使用。父级模板可指定一个区块，子模板覆盖这个区块，查看<a href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF">模板继承</a>。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">css</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;link rel=&quot;stylesheet&quot; href=&quot;app.css&quot; /&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>可以在循环中定义区块</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">items</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">item</span> <span class="cp">%}{{</span> <span class="nv">item</span> <span class="cp">}}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>子模板可以覆盖 <code>item</code> 区块并改变里面的内容。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;item.html&quot;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">item</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">The name of the item is: </span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>在区块中，你可以调用特殊的<code>super</code>函数。它会渲染父级区块中的内容。具体请查看<a href="#super">super</a>。</p>

<h3 id="include">include</h3>

<p><code>include</code> 可引入其他的模板，可以在多模板之间共享一些小模板，如果某个模板已使用了继承那么 <code>include</code> 将会非常有用。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;item.html&quot;</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>可在循环中引入模板</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">items</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;item.html&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>这一点可以帮助我们把模板切分成更小的部分，从而使得在浏览器上，当我们需要改变页面时，我们可以渲染这些小部分的模板，而非一整个的大的模板。</p>

<p><code>include</code> 可以接受任意表达式，只要它最终返回一个字符串或是模板所编译成的对象: <code>{% include name + &quot;.html&quot; as obj %}</code>.</p>

<p>在某些情况下，我们可能希望在模板文件不存在时不要抛出异常。对于这类情况，我们可以使用<code>ignore missing</code>来略过这些异常：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;missing.html&quot;</span> <span class="k">ignore missing</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>被包含的模版自身可以扩展(<code>extends</code>)另一个模版（因此你可以让一系列相关联的模版继承同一种结构）。
一个被包含的模版并不会改变包含它的模版的区块结构，它有一个分离的继承树和块级命名空间。换言之，
在渲染时，<code>include</code>并不 <em>不是</em> 将被包含模版代码拉取到包含它的模版中的预处理器。相对的，它对被
包含的模版触发了一次的分离渲染，然后再将渲染的结果引入。</p>

<h3 id="import">import</h3>

<p><code>import</code> 可加载不同的模板，可使你操作模板输出的数据，模板将会输出宏 (macro) 和在顶级作用域进行的赋值 (使用 <a href="#set"><code>set</code></a>)。</p>

<p>被 import 进来的模板没有当前模板的上下文，所以无法使用当前模板的变量，</p>

<p>创建一个叫 <code>forms.html</code> 如下所示</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">field</span><span class="o">(</span><span class="nv">name</span><span class="o">,</span> <span class="nv">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">,</span> <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;div class=&quot;field&quot;&gt;</span>
<span class="x">  &lt;input type=&quot;</span><span class="cp">{{</span> <span class="nv">type</span> <span class="cp">}}</span><span class="x">&quot; name=&quot;</span><span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">         value=&quot;</span><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">escape</span> <span class="cp">}}</span><span class="x">&quot; /&gt;</span>
<span class="x">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">macro</span> <span class="nv">label</span><span class="o">(</span><span class="nv">text</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;div&gt;</span>
<span class="x">  &lt;label&gt;</span><span class="cp">{{</span> <span class="nv">text</span> <span class="cp">}}</span><span class="x">&lt;/label&gt;</span>
<span class="x">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>我们可以 import 这个模板并将模板的输出绑定到变量 <code>forms</code> 上，然后就可以使用这个变量了：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">import</span> <span class="s2">&quot;forms.html&quot;</span> <span class="k">as</span> <span class="nv">forms</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{{</span> <span class="nv">forms.label</span><span class="o">(</span><span class="s1">&#39;Username&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">forms.input</span><span class="o">(</span><span class="s1">&#39;user&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">forms.label</span><span class="o">(</span><span class="s1">&#39;Password&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">forms.input</span><span class="o">(</span><span class="s1">&#39;pass&#39;</span><span class="o">,</span> <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>也可以使用 <code>from import</code> 从模板中 import 指定的值到当前的命名空间：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">from</span> <span class="s2">&quot;forms.html&quot;</span> <span class="k">import</span> <span class="nv">input</span><span class="o">,</span> <span class="nv">label</span> <span class="k">as</span> <span class="nv">description</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{{</span> <span class="nv">description</span><span class="o">(</span><span class="s1">&#39;Username&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">input</span><span class="o">(</span><span class="s1">&#39;user&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">description</span><span class="o">(</span><span class="s1">&#39;Password&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">input</span><span class="o">(</span><span class="s1">&#39;pass&#39;</span><span class="o">,</span> <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p><code>import</code> 可以接受任意表达式，只要它最终返回一个字符串或是模板所编译成的对象: <code>{% import name + &quot;.html&quot; as obj %}</code>.</p>

<h3 id="raw">raw</h3>

<p>如果你想输出一些 Nunjucks 特殊的标签 (如 <code>{{</code>)，可以使用 <code>{{</code>)，可以使用 <code>{% raw %}</code> 将所有的内容输出为纯文本。</p>

<h3 id="filter">filter</h3>

<p><code>filter</code>区块允许我们使用区块中的内容来调用过滤器。不同于使用<code>|</code>语法，它会将区块渲染出的内容传递给过滤器。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">filter</span> <span class="nf">title</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">may the force be with you</span>
<span class="cp">{%</span> <span class="k">endfilter</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">filter</span> <span class="nf">replace</span><span class="o">(</span><span class="s2">&quot;force&quot;</span><span class="o">,</span> <span class="s2">&quot;forth&quot;</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">may the force be with you</span>
<span class="cp">{%</span> <span class="k">endfilter</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>切记：你不能在这些区块中进行任何异步操作。</p>

<h3 id="call">call</h3>

<p><code>call</code>区块允许你使用标签之间的内容来调用一个宏。这在你需要给宏传入大量内容时是十分有用的。在宏中，你可以通过<code>caller()</code>来获取这些内容。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">add</span><span class="o">(</span><span class="nv">x</span><span class="o">,</span> <span class="nv">y</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">caller</span><span class="o">()</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">x</span> <span class="o">+</span> <span class="nv">y</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endmacro</span><span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">call</span> <span class="nv">add</span><span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">)</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">The result is</span>
<span class="cp">{%</span>- <span class="k">endcall</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>上面的例子将会输出&quot;The result is: 3&quot;。</p>

<h2 id="part-9d9c663eba1f6097">关键字参数</h2>

<p>jinja2 使用 Python 的关键字参数，支持函数，过滤器和宏。Nunjucks 会通过一个调用转换 (calling convention) 来支持。</p>

<p>关键字参数如下：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">,</span> <span class="nv">bar</span><span class="o">=</span><span class="m">3</span><span class="o">,</span> <span class="nv">baz</span><span class="o">=</span><span class="m">4</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p><code>bar</code> 和 <code>baz</code> 为关键字参数，Nunjucks 将他们转换成一个对象作为最后一个参数传入，等价于 javascript 的如下调用：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">{</span> <span class="nx">bar</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">baz</span><span class="o">:</span> <span class="mi">4</span><span class="p">})</span>
</code></pre></div>
<p>因为这使一个标准的调用转换，所以适用于所有的符合预期的函数和过滤器。查看 <a href="api#Keyword-Arguments">API 章节</a>获得更多信息。</p>

<p>定义宏的时候也可以使用关键字参数，定义参数值时可设置默认值。Nunjucks 会自动将关键字参数与宏里定义的值做匹配。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">foo</span><span class="o">(</span><span class="nv">x</span><span class="o">,</span> <span class="nv">y</span><span class="o">,</span> <span class="nv">z</span><span class="o">=</span><span class="m">5</span><span class="o">,</span> <span class="nv">w</span><span class="o">=</span><span class="m">6</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">x</span> <span class="cp">}}</span><span class="x">, </span><span class="cp">{{</span> <span class="nv">y</span> <span class="cp">}}</span><span class="x">, </span><span class="cp">{{</span> <span class="nv">z</span> <span class="cp">}}</span><span class="x">, </span><span class="cp">{{</span> <span class="nv">w</span><span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">)</span> <span class="cp">}}</span><span class="x">        -&gt; 1, 2, 5, 6</span>
<span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">,</span> <span class="nv">w</span><span class="o">=</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span><span class="x">  -&gt; 1, 2, 5, 10</span>
</code></pre></div>
<p>在宏中还可以混合使用位置参数 (positional arguments) 和关键字参数。如示例，你可以将位置参数用作关键字参数：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">20</span><span class="o">,</span> <span class="nv">y</span><span class="o">=</span><span class="m">21</span><span class="o">)</span> <span class="cp">}}</span><span class="x">     -&gt; 20, 21, 5, 6</span>
</code></pre></div>
<p>你还可以用位置参数来替换关键字参数：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">5</span><span class="o">,</span> <span class="m">6</span><span class="o">,</span> <span class="m">7</span><span class="o">,</span> <span class="m">8</span><span class="o">)</span> <span class="cp">}}</span><span class="x">   -&gt; 5, 6, 7, 8</span>
</code></pre></div>
<p>如下示例，你可以跳过 (&quot;skip&quot;) 位置参数：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">8</span><span class="o">,</span> <span class="nv">z</span><span class="o">=</span><span class="m">7</span><span class="o">)</span> <span class="cp">}}</span><span class="x">      -&gt; 8, , 7, 6</span>
</code></pre></div>
<h2 id="part-6542d68b860">注释</h2>

<p>你可以使用 <code>{#</code> and <code>#}</code> 来写注释，渲染时将会去除所有的注释。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="c">{# Loop through all the users #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">user</span> <span class="k">in</span> <span class="nv">users</span> <span class="cp">%}</span><span class="x">...</span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<h2 id="part-861ece9d8e5ce60c">空白字符控制</h2>

<p>模板在正常情况会将变量 (variable) 和标签区块 (tag blocks) 周围的空白字符完全输出。有时，你不想输出一些额外的空白字符，但代码又需要一些空白字符来显得整洁。</p>

<p>你可以在开始和结束区块 (start or end block tag) 添加 (<code>-</code>) 来去除前面和后面的空白字符。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">i</span> <span class="k">in</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">,</span><span class="m">4</span><span class="o">,</span><span class="m">5</span><span class="o">]</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">i</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span>- <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>上面准确的输出为 &quot;12345&quot;，<code>-%}</code> 会去除标签右侧的空白字符，<code>{%-</code> 会去除标签之前的空白字符。</p>

<h2 id="part-3787096c788cc4a">表达式</h2>

<p>你可以使用和 javascript 一样的字面量。</p>

<ul>
<li>Strings: <code>&quot;How are you?&quot;</code>, <code>&#39;How are you?&#39;</code></li>
<li>Numbers: <code>40</code>, <code>30.123</code></li>
<li>Arrays: <code>[1, 2, &quot;array&quot;]</code></li>
<li>Dicts: <code>{ one: 1, two: 2 }</code></li>
<li>Boolean: <code>true</code>, <code>false</code></li>
</ul>

<h3 id="math">运算 (Math)</h3>

<p>Nunjucks 支持运算 (但尽量少用，把逻辑放在代码中)，可使用以下操作符：</p>

<ul>
<li>Addition: <code>+</code></li>
<li>Subtraction: <code>-</code></li>
<li>Division: <code>/</code></li>
<li>Division and integer truncation: <code>//</code></li>
<li>Division remainder: <code>%</code></li>
<li>Multiplication: <code>*</code></li>
<li>Power: <code>**</code></li>
</ul>

<p>可以如下使用：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="m">2</span> <span class="o">+</span> <span class="m">3</span> <span class="cp">}}</span><span class="x">       (outputs 5)</span>
<span class="cp">{{</span> <span class="m">10</span><span class="o">/</span><span class="m">5</span> <span class="cp">}}</span><span class="x">        (outputs 2)</span>
<span class="cp">{{</span> <span class="nv">numItems</span><span class="o">*</span><span class="m">2</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<h3 id="comparisons">比较 (Comparisons)</h3>

<ul>
<li><code>==</code></li>
<li><code>===</code></li>
<li><code>!=</code></li>
<li><code>!==</code></li>
<li><code>&gt;</code></li>
<li><code>&gt;=</code></li>
<li><code>&lt;</code></li>
<li><code>&lt;=</code></li>
</ul>

<p>Examples:</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="x">{%-` 会去除标签之前的空白字符。</span>

<span class="x">## 表达式</span>

<span class="x">你可以使用和 javascript 一样的字面量。</span>

<span class="x">* Strings: `&quot;How are you?&quot;`, `&#39;How are you?&#39;`</span>
<span class="x">* Numbers: `40`, `30.123`</span>
<span class="x">* Arrays: `[1, 2, &quot;array&quot;]`</span>
<span class="x">* Dicts: `{ one: 1, two: 2 }`</span>
<span class="x">* Boolean: `true`, `false`</span>

<span class="x">### 运算 (Math)</span>

<span class="x">Nunjucks 支持运算 (但尽量少用，把逻辑放在代码中)，可使用以下操作符：</span>

<span class="x">* Addition: `+`</span>
<span class="x">* Subtraction: `-`</span>
<span class="x">* Division: `/`</span>
<span class="x">* Division and integer truncation: `//`</span>
<span class="x">* Division remainder: `%`</span>
<span class="x">* Multiplication: `*`</span>
<span class="x">* Power: `**`</span>

<span class="x">可以如下使用：</span>

<span class="x">```jinja</span>
<span class="cp">{{</span> <span class="m">2</span> <span class="o">+</span> <span class="m">3</span> <span class="cp">}}</span><span class="x">       (outputs 5)</span>
<span class="cp">{{</span> <span class="m">10</span><span class="o">/</span><span class="m">5</span> <span class="cp">}}</span><span class="x">        (outputs 2)</span>
<span class="cp">{{</span> <span class="nv">numItems</span><span class="o">*</span><span class="m">2</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<h3 id="comparisons">比较 (Comparisons)</h3>

<ul>
<li><code>==</code></li>
<li><code>===</code></li>
<li><code>!=</code></li>
<li><code>!==</code></li>
<li><code>&gt;</code></li>
<li><code>&gt;=</code></li>
<li><code>&lt;</code></li>
<li><code>&lt;=</code></li>
</ul>

<p>Examples:</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">numUsers</span> <span class="o">&lt;</span> <span class="m">5</span> <span class="cp">%}</span><span class="x">...</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">i</span> <span class="o">==</span> <span class="m">0</span> <span class="cp">%}</span><span class="x">...</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<h3 id="logic">Logic</h3>

<ul>
<li><code>and</code></li>
<li><code>or</code></li>
<li><code>not</code></li>
<li>可使用大括号来分组</li>
</ul>

<p>Examples:</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">users</span> <span class="k">and</span> <span class="nv">showUsers</span> <span class="cp">%}</span><span class="x">...</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">i</span> <span class="o">==</span> <span class="m">0</span> <span class="k">and</span> <span class="k">not</span> <span class="nv">hideFirst</span> <span class="cp">%}</span><span class="x">...</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">if</span> <span class="o">(</span><span class="nv">x</span> <span class="o">&lt;</span> <span class="m">5</span> <span class="k">or</span> <span class="nv">y</span> <span class="o">&lt;</span> <span class="m">5</span><span class="o">)</span> <span class="k">and</span> <span class="nv">foo</span> <span class="cp">%}</span><span class="x">...</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<h3 id="if">If 表达式</h3>

<p>和 javascript 的三元运算符 (ternary operator) 一样，可使用 if 的内联表达式：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="nv">foo</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>当 foo 为 true 的时候最终输出 &quot;true&quot; 否则为 &quot;false&quot;，对于获取默认值的时候非常有用：</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">baz</span><span class="o">(</span><span class="nv">foo</span> <span class="k">if</span> <span class="nv">foo</span> <span class="k">else</span> <span class="s2">&quot;default&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<h3 id="function-calls">函数调用 (Function Calls)</h3>

<p>如果你传入一个函数，则可以直接调用</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span><span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">,</span> <span class="m">3</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<h3 id="part-f8640494c1eb9d66">正则表达式</h3>

<p>你可以像在JavaScript中一样创建一个正则表达式:</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="o">/</span><span class="err">^</span><span class="nv">foo</span><span class="err">.</span><span class="o">*/</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{{</span> <span class="o">/</span><span class="nv">bar</span><span class="err">$</span><span class="o">/</span><span class="nv">g</span> <span class="cp">}}</span><span class="x"></span>
</code></pre></div>
<p>正则表达式所支持的标志如下。查阅<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/RegExp">Regex on MDN</a>以获取更多信息。</p>

<ul>
<li><code>g</code>: 应用到全局</li>
<li><code>i</code>: 不区分大小写</li>
<li><code>m</code>: 多行模式</li>
<li><code>y</code>: 粘性支持（sticky）</li>
</ul>

<h2 id="autoescaping">自动转义 (Autoescaping)</h2>

<p>如果在环境变量中设置了 autoescaping，所有的输出都会自动转义，但可以使用 <code>safe</code> 过滤器，Nunjucks 就不会转义了。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span> <span class="cp">}}</span><span class="x">           // &amp;lt;span%gt;</span>
<span class="cp">{{</span> <span class="nv">foo</span> <span class="o">|</span> <span class="nf">safe</span> <span class="cp">}}</span><span class="x">    // &lt;span&gt;</span>
</code></pre></div>
<p>如果未开启 autoescaping，所有的输出都会如实输出，但可以使用 <code>escape</code> 过滤器来转义。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{{</span> <span class="nv">foo</span> <span class="cp">}}</span><span class="x">           // &lt;span&gt;</span>
<span class="cp">{{</span> <span class="nv">foo</span> <span class="o">|</span> <span class="nf">escape</span> <span class="cp">}}</span><span class="x">  // &amp;lt;span&amp;gt;</span>
</code></pre></div>
<h2 id="global-functions">全局函数 (Global Functions)</h2>

<p>以下为一些内置的全局函数</p>

<h3 id="range-start-stop-step">range([start], stop, [step])</h3>

<p>如果你需要遍历固定范围的数字可以使用 <code>range</code>，<code>start</code> (默认为 0) 为起始数字，<code>stop</code> 为结束数字，<code>step</code> 为间隔 (默认为 1)。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">i</span> <span class="k">in</span> <span class="nv">range</span><span class="o">(</span><span class="m">0</span><span class="o">,</span> <span class="m">5</span><span class="o">)</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">i</span> <span class="cp">}}</span><span class="x">,</span>
<span class="cp">{%</span>- <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>上面输出 <code>0,1,2,3,4</code>.</p>

<h3 id="cycler-item1-item2-itemn">cycler(item1, item2, ...itemN)</h3>

<p><code>cycler</code> 可以循环调用你指定的一系列的值。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">cls</span> <span class="o">=</span> <span class="nv">cycler</span><span class="o">(</span><span class="s2">&quot;odd&quot;</span><span class="o">,</span> <span class="s2">&quot;even&quot;</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">row</span> <span class="k">in</span> <span class="nv">rows</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  &lt;div class=&quot;</span><span class="cp">{{</span> <span class="nv">cls.next</span><span class="o">()</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">row.name</span> <span class="cp">}}</span><span class="x">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>上面的例子中奇数行的 class 为 &quot;odd&quot;，偶数行的 class 为 &quot;even&quot;。你可以使用<code>current</code>属性来获取当前项（在上面的例子中对应<code>cls.current</code>）。</p>

<h3 id="joiner-separator">joiner([separator])</h3>

<p>当合并多项的时候，希望在他们之间又分隔符 (像逗号)，但又不希望第一项也输出。<code>joiner</code> 将输出分割符 (默认为 &quot;,&quot;) 除了第一次调用。</p>
<div class="highlight"><pre><code class="language-jinja" data-lang="jinja"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">comma</span> <span class="o">=</span> <span class="nv">joiner</span><span class="o">()</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">tag</span> <span class="k">in</span> <span class="nv">tags</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">comma</span><span class="o">()</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">tag</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span>- <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</code></pre></div>
<p>如果 <code>tags</code> 为 <code>[&quot;food&quot;, &quot;beer&quot;, &quot;dessert&quot;]</code>, 上面将输出 <code>food, beer, dessert</code>。</p>

<h2 id="part-cda1d805a3577fa5">内置的过滤器</h2>

<p>Nunjucks已经实现了jinja中的大部分过滤器，同时也新增了一些属于自己的过滤器。
我们需要为这些过滤器编写文档。下面是一部分过滤器的文档，其他的你可以点击链接查看jinja上的文档。</p>

<h3 id="default-value-default-boolean">default(value, default, [boolean])</h3>

<p>(简写为 <code>d</code>)</p>

<p>如果<code>value</code>全等于<code>undefined</code>则返回<code>default</code>，否则返回<code>value</code>。
如果<code>boolean</code>为true，则会在<code>value</code>为JavaScript中的假值时（比如：false, &quot;&quot;等）返回<code>default</code>。</p>

<p><strong>在2.0版本中，这个过滤器的默认表现与以前有所不同。在之前的版本中，它会把<code>boolean</code>的默认值
  设置为true，所以传入任何假值都会返回<code>default</code>。在2.0中，默认只有值为<code>undefined</code>时会
  返回<code>default</code>。如果你仍旧希望保持原来版本的表现的话，你可以给<code>boolean</code>传入<code>true</code>，或是
  直接使用<code>value or default</code>。</strong></p>

<h3 id="sort-arr-reverse-casesens-attr">sort(arr, reverse, caseSens, attr)</h3>

<p>用JavaScript中的<code>arr.sort</code>函数排序<code>arr</code>。如果<code>reverse</code>为true，则会返回相反的
排序结果。默认状态下排序不会区分大小写，但你可以将<code>caseSens</code>设置为true来让排序
区分大小写。我们可以用<code>attr</code>来指定要比较的属性。</p>

<h3 id="striptags-value-preserve_linebreaks">striptags (value, [preserve_linebreaks])</h3>

<p>类似于jinja中的<a href="http://jinja.pocoo.org/docs/templates/#striptags">striptags</a>.
如果<code>preserve_linebreaks</code>为false（同时也是默认值），则会移去SGML/XML标签并用一个空格符
替换临近的、连续的空白符号。如果<code>preserve_linebreaks</code>为true，则会尝试保留临近的空白符号。
如果你希望使用管道操作符进行类似于<code>{{ text | striptags | nl2br }}</code>这样的操作时，你就会
需要用到后一种。否则你还是应该使用默认的用法。</p>

<h3 id="dump-object">dump (object)</h3>

<p>在一个对象上调用<code>JSON.stringify</code>，并将结果输出到模板上。这在调试时很有用：<code>{{ foo | dump }}</code>。</p>

<h3 id="part-e05b7664d3942ab3">其他过滤器</h3>

<ul>
<li><a href="http://jinja.pocoo.org/docs/templates/#abs">abs</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#batch">batch</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#capitalize">capitalize</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#center">center</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#dictsort">dictsort</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#escape">escape</a> (简写为<code>e</code>)</li>
<li><a href="http://jinja.pocoo.org/docs/templates/#float">float</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#first">first</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#groupby">groupby</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#indent">indent</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#int">int</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#join">join</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#last">last</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#length">length</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#list">list</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#lower">lower</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#random">random</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#rejectattr">rejectattr</a> (只接受单个参数)</li>
<li><a href="http://jinja.pocoo.org/docs/templates/#replace">replace</a> (第一个参数也可以接受
JavaScript中的正则表达式)</li>
<li><a href="http://jinja.pocoo.org/docs/templates/#reverse">reverse</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#round">round</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#safe">safe</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#selectattr">selectattr</a> (只接受单个参数)</li>
<li><a href="http://jinja.pocoo.org/docs/templates/#slice">slice</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#string">string</a></li>
<li><a href="http://jinja.pocoo.org/docs/dev/templates/#sum">sum</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#title">title</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#trim">trim</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#truncate">truncate</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#upper">upper</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#urlencode">urlencode</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#urlize">urlize</a></li>
<li><a href="http://jinja.pocoo.org/docs/templates/#wordcount">wordcount</a></li>
</ul>

<p>你也可以直接<a href="https://github.com/mozilla/nunjucks/blob/master/src/filters.js">看代码</a>。</p>

  </div>
</div>



    <footer>
      Found a bug in the
      documentation? <a href="https://github.com/mozilla/nunjucks/tree/master/docs">Fix
      it or file an issue</a>!
    </footer>

    <script src="/nunjucks/bower_components/jquery/jquery.min.js"></script>
    <script src="/nunjucks/bower_components/bootstrap/js/affix.js"></script>

    <script src="/nunjucks/js/app.js"></script>
    <script src="/nunjucks/js/subpage.js"></script>

<!-- commented out temporarily while we figure out how to get GA for mozilla.github.io
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9014321-3', 'jlongster.github.io');
  ga('send', 'pageview');
</script>
-->
  </body>
</html>
